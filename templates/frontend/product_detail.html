{% extends "base.html" %}
{% block title %}{{ object.title }} - MURAシェア{% endblock %}

{% block content %}
<div class="row g-4">

  <div class="col-lg-6">
    {% with first=object.image_url %}
      {% if first %}
        <img src="{{ first }}" class="img-fluid mb-3 rounded" alt="{{ object.title }}">
      {% endif %}
    {% endwith %}

    {% for img in object.images.all %}
      <img src="{{ img.image.url }}" class="img-fluid mb-2 rounded" alt="image">
    {% empty %}
      {% if not object.image_url %}
        <div class="text-muted">画像なし</div>
      {% endif %}
    {% endfor %}
  </div>

  <div class="col-lg-6">
    <h2 class="h4">{{ object.title }}</h2>

    {% if object.category %}
      <div class="mb-2"><span class="badge bg-secondary">{{ object.category }}</span></div>
    {% endif %}

    {% if object.price_per_day %}
      <div class="mb-1">レンタル: <strong>¥{{ object.price_per_day|floatformat:0 }}/日</strong></div>
    {% endif %}
    {% if object.price_buy %}
      <div class="mb-3">販売: <strong>¥{{ object.price_buy|floatformat:0 }}</strong></div>
    {% endif %}

    {% if object.is_sold_out %}
      <div class="mb-3 text-danger fw-semibold">sold out</div>
    {% elif object.available_quantity or object.stock_quantity %}
      <div class="mb-3 text-muted">
        在庫:
        {% if object.available_quantity %}{{ object.available_quantity }}{% else %}0{% endif %}
        {% if object.stock_quantity %}/ {{ object.stock_quantity }}{% endif %}
      </div>
    {% endif %}

    <div class="mb-3">{{ object.description|linebreaksbr }}</div>

    {% if user.is_authenticated and user != object.owner %}
      <hr>
      {% if object.is_sold_out %}
        <div class="alert alert-secondary py-2 small mb-0">sold out</div>
      {% else %}
        <h3 class="h6">レンタル申請</h3>
        <form method="post" action="{% url 'rental_request' object.pk %}">
          {% csrf_token %}
          <div class="row g-2">
            <div class="col"><input type="date" name="start_date" class="form-control" required></div>
            <div class="col"><input type="date" name="end_date" class="form-control" required></div>
          </div>
          <button class="btn btn-success mt-2">申請する</button>
        </form>
      {% endif %}
    {% elif not user.is_authenticated %}
      <a href="{% url 'frontend:login' %}" class="btn btn-outline-primary">ログインしてレンタル申請</a>
    {% endif %}
  </div>

</div>
{% endblock %}

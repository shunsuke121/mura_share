{% extends "base.html" %}
{% load humanize %}

{% block title %}購入内容の確認{% endblock %}

{% block content %}
<div class="container-xxl py-4">
  <div class="d-flex align-items-center justify-content-between mb-3">
    <div>
      <h2 class="fw-bold mb-1">購入内容の確認</h2>
      <div class="text-muted">レンタル料金を差し引いた金額で購入します。</div>
    </div>
    <a href="{{ back_url }}" class="btn btn-outline-secondary">戻る</a>
  </div>

  <div class="card border-0 shadow-sm">
    <div class="card-body">
      <div class="d-flex align-items-start gap-3 mb-3">
        <div class="bg-light rounded-2 overflow-hidden" style="width:80px;height:80px;">
          {% if product.image_url %}
            <img src="{{ product.image_url }}" class="w-100 h-100" style="object-fit:cover;" alt="{{ product.title }}">
          {% else %}
            <div class="w-100 h-100 d-flex align-items-center justify-content-center small text-muted">No Image</div>
          {% endif %}
        </div>
        <div class="flex-grow-1">
          <div class="fw-semibold">{{ product.title }}</div>
          <div class="text-muted small">
            数量: {{ pricing.qty }}点
            {% if pricing.days_used %}
              / レンタル日数: {{ pricing.days_used }}日
            {% endif %}
          </div>
        </div>
      </div>

      <div class="row g-3">
        <div class="col-md-6">
          <div class="border rounded-2 p-3 h-100">
            <div class="text-muted small mb-1">購入金額</div>
            <div class="fs-4 fw-bold">¥{{ pricing.purchase_price|intcomma }}</div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="border rounded-2 p-3 h-100">
            <div class="text-muted small mb-1">レンタル利用料（差し引き）</div>
            <div class="fs-4 fw-bold text-danger">-¥{{ pricing.rental_cost|intcomma }}</div>
          </div>
        </div>
      </div>

      <div class="mt-3 border rounded-2 p-3 bg-light">
        <div class="text-muted small mb-1">お支払い金額</div>
        <div class="fs-3 fw-bold">¥{{ pricing.payable|intcomma }}</div>
      </div>

      <form method="post" action="{{ confirm_url }}" class="mt-4 d-flex gap-2">
        {% csrf_token %}
        <button type="submit" class="btn btn-primary flex-grow-1">この金額で購入する</button>
        <a href="{{ back_url }}" class="btn btn-outline-secondary">戻る</a>
      </form>
    </div>
  </div>
</div>
{% endblock %}

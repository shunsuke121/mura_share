{% extends "base.html" %}
{% load static %}
{% block title %}å•†å“ä¸€è¦§ - MURAã‚·ã‚§ã‚¢{% endblock %}

{% block content %}
<style>
  /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
  .products-head { position: sticky; top: 0; z-index: 10; background:#fff; border-bottom:1px solid #e5e7eb;}
  .search-input { padding-left:36px; background:#f3f4f6; border:0; height:38px; border-radius:10px; }
  .search-icon { position:absolute; left:12px; top:50%; transform:translateY(-50%); color:#9ca3af; }

  /* ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼è¡Œ */
  .filter-chip { min-width: 190px; }
  .filter-row .form-select { border-radius:10px; height:38px; }
  .filter-row .form-label { color:#6b7280; font-size:.9rem; margin-right:.5rem; }

  /* ã‚°ãƒªãƒƒãƒ‰ */
  .grid-3 { display:grid; grid-template-columns:repeat(3,1fr); gap:8px; }
  @media (max-width:992px){ .grid-3{ grid-template-columns:repeat(2,1fr);} }
  @media (max-width:576px){ .grid-3{ grid-template-columns:repeat(2,1fr);} }

  /* ã‚«ãƒ¼ãƒ‰ */
  .product-card { border:0; border-radius:14px; box-shadow:0 2px 10px rgba(15,23,42,.06); overflow:hidden; background:#fff; }
  .product-card .ratio { background:#f8fafc; }
  .product-card img { object-fit:cover; width:100%; height:100%; }
  .pc-body { padding:.6rem .6rem .75rem; }
  .pc-title { font-weight:700; font-size:.95rem; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
  .pc-cat { color:#6b7280; font-size:.8rem; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
  .pc-desc { color:#6b7280; font-size:.8rem; margin-top:.2rem;
             display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden; }
  .pc-price { font-weight:700; font-size:.9rem; }
  .pc-price-sub { color:#6b7280; font-size:.8rem; }
  .pc-meta { color:#6b7280; font-size:.78rem; margin-top:.25rem; }
  .pc-icons { display:flex; gap:.9rem; color:#6b7280; font-size:1rem; }
  .pc-icons .bi { vertical-align:middle; }
</style>

<div class="filters-bar py-3 border-bottom bg-white mb-3">
  <div class="container-xxl">
    <div class="d-flex flex-wrap align-items-center gap-2 gap-md-3">

      <!-- æ¤œç´¢ -->
      <div class="position-relative flex-grow-1" style="min-width:240px;">
        <i class="bi bi-search search-icon"></i>
        <input
          type="search"
          name="q"
          value="{{ request.GET.q }}"
          class="form-control form-control-sm ps-5"  <-- â† æ ã‚ã‚Š -->
      </div>

      <!-- ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
      <span class="filters-label text-muted d-none d-md-inline">ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼:</span>

      <select name="category" class="form-select form-select-sm w-auto">
        <option value="">ã™ã¹ã¦ã®ã‚«ãƒ†ã‚´ãƒªâ€•</option>
        <option value="é›»å­æ©Ÿå™¨">é›»å­æ©Ÿå™¨</option>
        <option value="å®¶å…·">å®¶å…·</option>
        <option value="ã‚¹ãƒãƒ¼ãƒ„ç”¨å“">ã‚¹ãƒãƒ¼ãƒ„ç”¨å“</option>
        <option value="æ¥½å™¨">æ¥½å™¨</option>
        <option value="è»Šä¸¡">è»Šä¸¡</option>
        <option value="ã‚¢ã‚¦ãƒˆãƒ‰ã‚¢ç”¨å“">ã‚¢ã‚¦ãƒˆãƒ‰ã‚¢ç”¨å“</option>
        <option value="ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³">ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³</option>
        <option value="æ›¸ç±ãƒ»ãƒ¡ãƒ‡ã‚£ã‚¢">æ›¸ç±ãƒ»ãƒ¡ãƒ‡ã‚£ã‚¢</option>
        <option value="ãã®ä»–">ãã®ä»–</option>
      </select>

      <select name="availability" class="form-select form-select-sm w-auto">
        <option value="">ã™ã¹ã¦</option>
        <option value="ãƒ¬ãƒ³ã‚¿ãƒ«ãƒ»è²©å£²ä¸¡æ–¹">ãƒ¬ãƒ³ã‚¿ãƒ«ãƒ»è²©å£²ä¸¡æ–¹</option>
        <option value="ãƒ¬ãƒ³ã‚¿ãƒ«ã®ã¿">ãƒ¬ãƒ³ã‚¿ãƒ«ã®ã¿</option>
        <option value="è²©å£²ã®ã¿">è²©å£²ã®ã¿</option>
      </select>

      <!-- ä¸¦ã³æ›¿ãˆï¼ˆå³å¯„ã›ï¼‰ -->
      <div class="ms-auto d-flex align-items-center gap-2">
        <span class="filters-label text-muted d-none d-md-inline">ä¸¦ã³æ›¿ãˆ:</span>
        <select name="sort" class="form-select form-select-sm w-auto">
          <option value="-id">æ–°ç€é †</option>
          <option value="price_asc">ä¾¡æ ¼(å®‰ã„é †)</option>
          <option value="price_desc">ä¾¡æ ¼(é«˜ã„é †)</option>
        </select>
      </div>

    </div>
  </div>
</div>


<div class="container-xxl py-3">
  {% if products %}
    <div class="grid-3">
      {% for p in products %}
        <div class="product-card">
          <a href="{% url 'frontend:product_detail' p.id %}">
            <div class="ratio ratio-1x1">
              {% if p.image_url %}
                <img src="{{ p.image_url }}" alt="{{ p.title }}">
              {% else %}
                <div class="d-flex align-items-center justify-content-center text-muted fs-1">ğŸ“¦</div>
              {% endif %}
            </div>
          </a>

          <div class="pc-body">
            <!-- ä¸Šæ®µ: ã„ã„ã­/ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¤ã‚³ãƒ³ï¼ˆé£¾ã‚Šï¼‰ -->
            <div class="d-flex justify-content-between mb-1">
              <div class="pc-icons">
                <i class="bi bi-heart"></i>
                <i class="bi bi-chat"></i>
              </div>
              {% if p.available_quantity or p.stock_quantity %}
                <div class="pc-meta">åœ¨åº« {{ p.available_quantity|default:0 }}{% if p.stock_quantity %}/{{ p.stock_quantity }}{% endif %}</div>
              {% endif %}
            </div>

            <!-- ä¾¡æ ¼ -->
            {% if p.price_per_day %}
              <div class="pc-price">Â¥{{ p.price_per_day|floatformat:0 }}/æ—¥</div>
            {% endif %}
            {% if p.price_buy %}
              <div class="pc-price-sub">è²©å£² Â¥{{ p.price_buy|floatformat:0 }}</div>
            {% endif %}

            <!-- ã‚¿ã‚¤ãƒˆãƒ«/ã‚«ãƒ†ã‚´ãƒª/èª¬æ˜ -->
            <div class="pc-title mt-1">{{ p.title }}</div>
            {% if p.category %}<div class="pc-cat">{{ p.category }}</div>{% endif %}
            {% if p.description %}<div class="pc-desc">{{ p.description|striptags }}</div>{% endif %}
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="text-center py-5">
      <div class="mx-auto mb-3 d-flex align-items-center justify-content-center rounded-circle" style="width:80px;height:80px;background:#f3f4f6;">
        <i class="bi bi-search" style="font-size:28px;color:#9ca3af;"></i>
      </div>
      <div class="fw-semibold">å•†å“ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ</div>
      <div class="text-muted">æ¤œç´¢æ¡ä»¶ã‚’å¤‰æ›´ã—ã¦ã¿ã¦ãã ã•ã„</div>
    </div>
  {% endif %}
</div>
{% endblock %}

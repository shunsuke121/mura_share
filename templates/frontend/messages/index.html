{% extends "base.html" %}
{% block title %}メッセージ - MURA SHARE{% endblock %}

{% block content %}
<div class="ms-section">
  <div class="ms-section-title">
    <div>
      <div class="ms-kicker">Messages</div>
      <h2>メッセージ</h2>
      <div class="ms-muted">取引相手との会話を一覧で確認できます。</div>
    </div>
  </div>

  <div class="ms-panel">
    {% if transactions %}
      <div class="chat-list">
        {% for t in transactions %}
          <a href="{{ t.chat_url }}" class="chat-row {% if t.unread %}is-unread{% endif %}">
            <div class="chat-avatar" aria-hidden="true">
              {{ t.other_name|default:"-"|first|upper }}
            </div>
            <div class="chat-row-main">
              <div class="chat-title">{{ t.product_title }}</div>
              <div class="chat-meta">
                <span class="badge chat-kind">{{ t.kind_label }}</span>
                <span class="chat-person">{{ t.other_name|default:"-" }}</span>
                <span class="badge chat-status">{{ t.status_label }}</span>
              </div>
              <div class="chat-last">
                {% if t.last_message %}
                  {{ t.last_message }}
                {% else %}
                  <span class="text-muted">まだメッセージがありません。</span>
                {% endif %}
              </div>
            </div>
            <div class="chat-row-side">
              <div class="chat-time">{{ t.activity_at|date:"n/j H:i" }}</div>
              {% if t.unread %}
                <span class="badge bg-danger rounded-pill">{{ t.unread }}</span>
              {% endif %}
              <i class="bi bi-chevron-right"></i>
            </div>
          </a>
        {% endfor %}
      </div>
    {% else %}
      <div class="ms-empty">メッセージはまだありません。</div>
    {% endif %}
  </div>
</div>
{% endblock %}
